<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Forecast.vk</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/pages.css') }}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="container">
        <header class="header">
            <div class="logo">
                <div class="logo-box">
                    <span class="logo-text">F.vk</span>
                </div>
                <h1>Forecast.vk</h1>
            </div>
            <div class="user-info">
                <span>Welcome, {{ current_user.email }}</span>
                <a href="{{ url_for('logout') }}" class="btn btn-secondary">Logout</a>
            </div>
        </header>

        <nav class="sidebar">
            <ul>
                <li><a href="{{ url_for('home') }}" class="active">Dashboard</a></li>
                <li><a href="{{ url_for('sales') }}">Sales</a></li>
                <li><a href="{{ url_for('purchases') }}">Purchases</a></li>
                <li><a href="{{ url_for('stock') }}">Stock</a></li>
                <li><a href="{{ url_for('customers') }}">Customers</a></li>
                <li><a href="{{ url_for('vendors') }}">Vendors</a></li>
                <li><a href="{{ url_for('insights') }}">Insights</a></li>
                <li><a href="{{ url_for('forecast_reports') }}">Forecast Reports</a></li>
                <li><a href="{{ url_for('import_data') }}">Import Data</a></li>
                {% if current_user.is_admin %}
                <li><a href="{{ url_for('admin') }}">Admin</a></li>
                {% endif %}
            </ul>
        </nav>

        <main class="main-content">
            <div class="page-header">
                <h2>Dashboard</h2>
                <p>Overview of your business performance</p>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon">ðŸ’°</div>
                    <div class="stat-content">
                        <h3>Total Sales</h3>
                        <p class="stat-value" id="totalSales">â‚¹0</p>
                        <span class="stat-change positive">+12.5%</span>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon">ðŸ›’</div>
                    <div class="stat-content">
                        <h3>Total Purchases</h3>
                        <p class="stat-value" id="totalPurchases">â‚¹0</p>
                        <span class="stat-change negative">-3.2%</span>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon">ðŸ“¦</div>
                    <div class="stat-content">
                        <h3>Stock Items</h3>
                        <p class="stat-value" id="stockItems">0</p>
                        <span class="stat-change positive">+5.8%</span>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon">ðŸ‘¥</div>
                    <div class="stat-content">
                        <h3>Active Customers</h3>
                        <p class="stat-value" id="activeCustomers">0</p>
                        <span class="stat-change positive">+8.1%</span>
                    </div>
                </div>
            </div>

            <div class="charts-grid">
                <div class="chart-container">
                    <h3>Sales vs Purchases</h3>
                    <canvas id="salesPurchasesChart"></canvas>
                </div>
                
                <div class="chart-container">
                    <h3>Monthly Revenue Trend</h3>
                    <canvas id="revenueChart"></canvas>
                </div>
            </div>

            <div class="recent-activity">
                <h3>Recent Activity</h3>
                <div class="activity-list" id="recentActivity">
                    <div class="activity-item">
                        <div class="activity-icon">ðŸ“Š</div>
                        <div class="activity-content">
                            <p><strong>Sales Report Generated</strong></p>
                            <span class="activity-time">2 hours ago</span>
                        </div>
                    </div>
                    <div class="activity-item">
                        <div class="activity-icon">ðŸ“¦</div>
                        <div class="activity-content">
                            <p><strong>Stock Updated</strong></p>
                            <span class="activity-time">4 hours ago</span>
                        </div>
                    </div>
                    <div class="activity-item">
                        <div class="activity-icon">ðŸ‘¤</div>
                        <div class="activity-content">
                            <p><strong>New Customer Added</strong></p>
                            <span class="activity-time">6 hours ago</span>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script src="{{ url_for('static', filename='js/script.js') }}"></script>
    <script>
        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            loadDashboardData();
            initializeCharts();
        });

        function loadDashboardData() {
            fetch('/api/dashboard-stats')
                .then(response => response.json())
                .then(data => {
                    document.getElementById('totalSales').textContent = 'â‚¹' + formatNumber(data.total_sales || 0);
                    document.getElementById('totalPurchases').textContent = 'â‚¹' + formatNumber(data.total_purchases || 0);
                    document.getElementById('stockItems').textContent = data.stock_items || 0;
                    document.getElementById('activeCustomers').textContent = data.active_customers || 0;
                })
                .catch(error => {
                    console.error('Error loading dashboard data:', error);
                    // Set default values if API fails
                    document.getElementById('totalSales').textContent = 'â‚¹1,25,000';
                    document.getElementById('totalPurchases').textContent = 'â‚¹85,000';
                    document.getElementById('stockItems').textContent = '156';
                    document.getElementById('activeCustomers').textContent = '42';
                });
        }

        function initializeCharts() {
            // Sales vs Purchases Chart
            const salesPurchasesCtx = document.getElementById('salesPurchasesChart').getContext('2d');
            new Chart(salesPurchasesCtx, {
                type: 'bar',
                data: {
                    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                    datasets: [{
                        label: 'Sales',
                        data: [12000, 19000, 15000, 25000, 22000, 30000],
                        backgroundColor: 'rgba(54, 162, 235, 0.8)',
                        borderColor: 'rgba(54, 162, 235, 1)',
                        borderWidth: 1
                    }, {
                        label: 'Purchases',
                        data: [8000, 12000, 10000, 18000, 15000, 20000],
                        backgroundColor: 'rgba(255, 99, 132, 0.8)',
                        borderColor: 'rgba(255, 99, 132, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });

            // Revenue Trend Chart
            const revenueCtx = document.getElementById('revenueChart').getContext('2d');
            new Chart(revenueCtx, {
                type: 'line',
                data: {
                    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                    datasets: [{
                        label: 'Revenue',
                        data: [4000, 7000, 5000, 7000, 7000, 10000],
                        borderColor: 'rgba(75, 192, 192, 1)',
                        backgroundColor: 'rgba(75, 192, 192, 0.2)',
                        borderWidth: 2,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        function formatNumber(num) {
            return new Intl.NumberFormat('en-IN').format(num);
        }
    </script>
</body>
</html>
